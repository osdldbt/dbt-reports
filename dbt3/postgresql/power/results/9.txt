BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%floral%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |   sum_profit   
---------------------------+--------+----------------
 ALGERIA                   |   1998 | 267773837.7525
 ALGERIA                   |   1997 | 451553463.2109
 ALGERIA                   |   1996 | 459919953.4868
 ALGERIA                   |   1995 | 461255577.8983
 ALGERIA                   |   1994 | 459262427.0227
 ALGERIA                   |   1993 | 459844177.7604
 ALGERIA                   |   1992 | 459203807.0272
 ARGENTINA                 |   1998 | 278967358.6796
 ARGENTINA                 |   1997 | 474199928.5982
 ARGENTINA                 |   1996 | 477233228.7221
 ARGENTINA                 |   1995 | 469620040.7520
 ARGENTINA                 |   1994 | 477538802.3751
 ARGENTINA                 |   1993 | 468475731.1229
 ARGENTINA                 |   1992 | 473144452.1976
 BRAZIL                    |   1998 | 273180275.8450
 BRAZIL                    |   1997 | 463078944.1280
 BRAZIL                    |   1996 | 461297085.2597
 BRAZIL                    |   1995 | 469458292.4526
 BRAZIL                    |   1994 | 467814240.3022
 BRAZIL                    |   1993 | 469186155.1787
 BRAZIL                    |   1992 | 467590988.9391
 CANADA                    |   1998 | 278629898.9758
 CANADA                    |   1997 | 479013140.0942
 CANADA                    |   1996 | 476096476.0134
 CANADA                    |   1995 | 475271556.0366
 CANADA                    |   1994 | 471755643.6808
 CANADA                    |   1993 | 471811564.6520
 CANADA                    |   1992 | 472225636.3401
 CHINA                     |   1998 | 265789284.0590
 CHINA                     |   1997 | 468859334.4989
 CHINA                     |   1996 | 468329049.5704
 CHINA                     |   1995 | 463613200.8028
 CHINA                     |   1994 | 472645057.1409
 CHINA                     |   1993 | 474218890.7332
 CHINA                     |   1992 | 467163984.2810
 EGYPT                     |   1998 | 276774146.1910
 EGYPT                     |   1997 | 463420622.4752
 EGYPT                     |   1996 | 468382764.6415
 EGYPT                     |   1995 | 467344932.7221
 EGYPT                     |   1994 | 463257188.8627
 EGYPT                     |   1993 | 460108078.6755
 EGYPT                     |   1992 | 462691427.9903
 ETHIOPIA                  |   1998 | 270119568.6221
 ETHIOPIA                  |   1997 | 451038293.2915
 ETHIOPIA                  |   1996 | 447571719.1652
 ETHIOPIA                  |   1995 | 461072827.6373
 ETHIOPIA                  |   1994 | 447528319.1224
 ETHIOPIA                  |   1993 | 449900574.4884
 ETHIOPIA                  |   1992 | 456486220.8341
 FRANCE                    |   1998 | 269768745.5479
 FRANCE                    |   1997 | 456984396.3222
 FRANCE                    |   1996 | 463460612.7669
 FRANCE                    |   1995 | 460860949.5779
 FRANCE                    |   1994 | 457752959.2398
 FRANCE                    |   1993 | 472787710.8972
 FRANCE                    |   1992 | 460744465.9972
 GERMANY                   |   1998 | 276132665.4685
 GERMANY                   |   1997 | 476064488.1725
 GERMANY                   |   1996 | 472137662.0433
 GERMANY                   |   1995 | 473862107.5839
 GERMANY                   |   1994 | 471864740.1463
 GERMANY                   |   1993 | 475866139.5166
 GERMANY                   |   1992 | 479272602.1704
 INDIA                     |   1998 | 275728661.5336
 INDIA                     |   1997 | 463091867.6513
 INDIA                     |   1996 | 471139217.8786
 INDIA                     |   1995 | 467247537.0777
 INDIA                     |   1994 | 462340628.4867
 INDIA                     |   1993 | 467065869.9484
 INDIA                     |   1992 | 473157652.5230
 INDONESIA                 |   1998 | 274338111.4014
 INDONESIA                 |   1997 | 465762258.4113
 INDONESIA                 |   1996 | 470973116.1746
 INDONESIA                 |   1995 | 467889992.7011
 INDONESIA                 |   1994 | 462817292.1664
 INDONESIA                 |   1993 | 460209520.5306
 INDONESIA                 |   1992 | 466558449.8501
 IRAN                      |   1998 | 268591431.1291
 IRAN                      |   1997 | 456653094.3071
 IRAN                      |   1996 | 454198263.4346
 IRAN                      |   1995 | 450023274.5536
 IRAN                      |   1994 | 453305481.4558
 IRAN                      |   1993 | 459609575.6292
 IRAN                      |   1992 | 460613551.6171
 IRAQ                      |   1998 | 277633707.5574
 IRAQ                      |   1997 | 463944481.6677
 IRAQ                      |   1996 | 472504359.6893
 IRAQ                      |   1995 | 473995381.2465
 IRAQ                      |   1994 | 473104809.8980
 IRAQ                      |   1993 | 478145579.6618
 IRAQ                      |   1992 | 468910839.0829
 JAPAN                     |   1998 | 268295924.4734
 JAPAN                     |   1997 | 464749752.7231
 JAPAN                     |   1996 | 458346558.0967
 JAPAN                     |   1995 | 459605234.3101
 JAPAN                     |   1994 | 451804929.9974
 JAPAN                     |   1993 | 455274021.9647
 JAPAN                     |   1992 | 461733218.6794
 JORDAN                    |   1998 | 270151031.1373
 JORDAN                    |   1997 | 469784436.3535
 JORDAN                    |   1996 | 465232678.7906
 JORDAN                    |   1995 | 457800999.8493
 JORDAN                    |   1994 | 464454450.5158
 JORDAN                    |   1993 | 460260522.9931
 JORDAN                    |   1992 | 465584726.8851
 KENYA                     |   1998 | 273925004.5653
 KENYA                     |   1997 | 455663587.1435
 KENYA                     |   1996 | 456307029.7852
 KENYA                     |   1995 | 452850610.7337
 KENYA                     |   1994 | 460688735.5902
 KENYA                     |   1993 | 463964241.9489
 KENYA                     |   1992 | 456616259.9476
 MOROCCO                   |   1998 | 272448115.7483
 MOROCCO                   |   1997 | 452688336.1706
 MOROCCO                   |   1996 | 464157929.5116
 MOROCCO                   |   1995 | 471389142.8012
 MOROCCO                   |   1994 | 472895258.0374
 MOROCCO                   |   1993 | 459368990.0458
 MOROCCO                   |   1992 | 462119930.4965
 MOZAMBIQUE                |   1998 | 262418726.4297
 MOZAMBIQUE                |   1997 | 448759014.1175
 MOZAMBIQUE                |   1996 | 451718978.8081
 MOZAMBIQUE                |   1995 | 452050623.3627
 MOZAMBIQUE                |   1994 | 453092255.6531
 MOZAMBIQUE                |   1993 | 449582508.1646
 MOZAMBIQUE                |   1992 | 448699999.5523
 PERU                      |   1998 | 272360005.0673
 PERU                      |   1997 | 459390410.8480
 PERU                      |   1996 | 464284803.9037
 PERU                      |   1995 | 456591868.6628
 PERU                      |   1994 | 456244278.5334
 PERU                      |   1993 | 453264752.4529
 PERU                      |   1992 | 454167167.5781
 ROMANIA                   |   1998 | 267669949.2018
 ROMANIA                   |   1997 | 464147617.6537
 ROMANIA                   |   1996 | 467236253.0016
 ROMANIA                   |   1995 | 461748083.2352
 ROMANIA                   |   1994 | 468531541.4838
 ROMANIA                   |   1993 | 456425146.1993
 ROMANIA                   |   1992 | 466090252.4304
 RUSSIA                    |   1998 | 276050533.5941
 RUSSIA                    |   1997 | 462520581.2295
 RUSSIA                    |   1996 | 470622685.1593
 RUSSIA                    |   1995 | 468050394.1428
 RUSSIA                    |   1994 | 467592361.9319
 RUSSIA                    |   1993 | 469151953.2331
 RUSSIA                    |   1992 | 468222085.6904
 SAUDI ARABIA              |   1998 | 275723830.8687
 SAUDI ARABIA              |   1997 | 462325772.9355
 SAUDI ARABIA              |   1996 | 454829905.6195
 SAUDI ARABIA              |   1995 | 460706052.0599
 SAUDI ARABIA              |   1994 | 460261818.8795
 SAUDI ARABIA              |   1993 | 456435450.4903
 SAUDI ARABIA              |   1992 | 462157517.2536
 UNITED KINGDOM            |   1998 | 277264996.3281
 UNITED KINGDOM            |   1997 | 456776812.0566
 UNITED KINGDOM            |   1996 | 464805432.0284
 UNITED KINGDOM            |   1995 | 467065491.9968
 UNITED KINGDOM            |   1994 | 465158283.3285
 UNITED KINGDOM            |   1993 | 465804556.7971
 UNITED KINGDOM            |   1992 | 471413900.3966
 UNITED STATES             |   1998 | 277477203.1676
 UNITED STATES             |   1997 | 478280358.7692
 UNITED STATES             |   1996 | 473331677.3978
 UNITED STATES             |   1995 | 475106195.3719
 UNITED STATES             |   1994 | 478769640.6794
 UNITED STATES             |   1993 | 477303204.9302
 UNITED STATES             |   1992 | 471659883.3673
 VIETNAM                   |   1998 | 267412723.4917
 VIETNAM                   |   1997 | 460350250.6365
 VIETNAM                   |   1996 | 463423811.4982
 VIETNAM                   |   1995 | 450204817.4888
 VIETNAM                   |   1994 | 452705956.1682
 VIETNAM                   |   1993 | 466214526.0406
 VIETNAM                   |   1992 | 454717650.6467
(175 rows)

COMMIT;
COMMIT
