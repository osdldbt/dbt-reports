BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%dark%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |   sum_profit   
---------------------------+--------+----------------
 ALGERIA                   |   1998 | 266281983.0455
 ALGERIA                   |   1997 | 444296739.7038
 ALGERIA                   |   1996 | 454102547.1985
 ALGERIA                   |   1995 | 448358733.0296
 ALGERIA                   |   1994 | 454185157.5924
 ALGERIA                   |   1993 | 449575937.7514
 ALGERIA                   |   1992 | 453983312.7121
 ARGENTINA                 |   1998 | 270711690.2669
 ARGENTINA                 |   1997 | 468734234.7695
 ARGENTINA                 |   1996 | 470670372.6354
 ARGENTINA                 |   1995 | 462863423.8342
 ARGENTINA                 |   1994 | 468384260.2606
 ARGENTINA                 |   1993 | 474260353.5799
 ARGENTINA                 |   1992 | 464343882.1606
 BRAZIL                    |   1998 | 269974693.4330
 BRAZIL                    |   1997 | 465512595.6766
 BRAZIL                    |   1996 | 470761777.7566
 BRAZIL                    |   1995 | 469420611.6858
 BRAZIL                    |   1994 | 481868349.9520
 BRAZIL                    |   1993 | 469447961.8994
 BRAZIL                    |   1992 | 468726819.3204
 CANADA                    |   1998 | 280611664.0863
 CANADA                    |   1997 | 465959972.6901
 CANADA                    |   1996 | 474796056.8311
 CANADA                    |   1995 | 473825067.7456
 CANADA                    |   1994 | 488008301.3107
 CANADA                    |   1993 | 478213037.3574
 CANADA                    |   1992 | 472781582.4478
 CHINA                     |   1998 | 279125740.6480
 CHINA                     |   1997 | 476496242.6362
 CHINA                     |   1996 | 473819231.7841
 CHINA                     |   1995 | 475706180.3506
 CHINA                     |   1994 | 481713045.9157
 CHINA                     |   1993 | 474537154.1861
 CHINA                     |   1992 | 475851482.0391
 EGYPT                     |   1998 | 273542566.1626
 EGYPT                     |   1997 | 465892781.0415
 EGYPT                     |   1996 | 470966283.8676
 EGYPT                     |   1995 | 456403213.7125
 EGYPT                     |   1994 | 456176603.8318
 EGYPT                     |   1993 | 458832305.9488
 EGYPT                     |   1992 | 462278483.1967
 ETHIOPIA                  |   1998 | 269412951.9238
 ETHIOPIA                  |   1997 | 464121392.3179
 ETHIOPIA                  |   1996 | 465853039.1864
 ETHIOPIA                  |   1995 | 463127601.5255
 ETHIOPIA                  |   1994 | 464551020.0786
 ETHIOPIA                  |   1993 | 461336312.9237
 ETHIOPIA                  |   1992 | 467583438.4020
 FRANCE                    |   1998 | 271192474.7558
 FRANCE                    |   1997 | 457069298.1916
 FRANCE                    |   1996 | 460965623.0975
 FRANCE                    |   1995 | 453039637.7299
 FRANCE                    |   1994 | 468924456.8267
 FRANCE                    |   1993 | 456961844.3424
 FRANCE                    |   1992 | 465741183.8219
 GERMANY                   |   1998 | 273057385.5107
 GERMANY                   |   1997 | 474139593.3792
 GERMANY                   |   1996 | 477861925.5478
 GERMANY                   |   1995 | 473778299.2174
 GERMANY                   |   1994 | 471203146.9096
 GERMANY                   |   1993 | 478136451.3949
 GERMANY                   |   1992 | 477173693.1852
 INDIA                     |   1998 | 279759356.5371
 INDIA                     |   1997 | 472030586.1305
 INDIA                     |   1996 | 477755215.8154
 INDIA                     |   1995 | 473386069.6407
 INDIA                     |   1994 | 475109887.6456
 INDIA                     |   1993 | 478400024.9786
 INDIA                     |   1992 | 475523704.9761
 INDONESIA                 |   1998 | 269706965.1513
 INDONESIA                 |   1997 | 457878090.5539
 INDONESIA                 |   1996 | 461928489.2069
 INDONESIA                 |   1995 | 463359655.3745
 INDONESIA                 |   1994 | 458974563.4057
 INDONESIA                 |   1993 | 461559780.9469
 INDONESIA                 |   1992 | 455267954.2828
 IRAN                      |   1998 | 271635199.4335
 IRAN                      |   1997 | 464615740.3326
 IRAN                      |   1996 | 461785498.5306
 IRAN                      |   1995 | 462079684.3978
 IRAN                      |   1994 | 452138316.4163
 IRAN                      |   1993 | 457062319.8873
 IRAN                      |   1992 | 459460236.4596
 IRAQ                      |   1998 | 278827363.7861
 IRAQ                      |   1997 | 474392240.4523
 IRAQ                      |   1996 | 482936082.5044
 IRAQ                      |   1995 | 479686302.6365
 IRAQ                      |   1994 | 478971985.6334
 IRAQ                      |   1993 | 481381982.0679
 IRAQ                      |   1992 | 466856681.4906
 JAPAN                     |   1998 | 274448275.9006
 JAPAN                     |   1997 | 466932417.2674
 JAPAN                     |   1996 | 463381430.4989
 JAPAN                     |   1995 | 470568813.2856
 JAPAN                     |   1994 | 468739074.0881
 JAPAN                     |   1993 | 464960746.0236
 JAPAN                     |   1992 | 458554685.2570
 JORDAN                    |   1998 | 268279194.3117
 JORDAN                    |   1997 | 453711793.5334
 JORDAN                    |   1996 | 464049430.1875
 JORDAN                    |   1995 | 457413043.7007
 JORDAN                    |   1994 | 457169796.8205
 JORDAN                    |   1993 | 463516040.2421
 JORDAN                    |   1992 | 464410283.9637
 KENYA                     |   1998 | 280065726.1969
 KENYA                     |   1997 | 473443945.7057
 KENYA                     |   1996 | 475232069.7538
 KENYA                     |   1995 | 472706535.7697
 KENYA                     |   1994 | 477554943.1420
 KENYA                     |   1993 | 486328609.6841
 KENYA                     |   1992 | 475616572.7436
 MOROCCO                   |   1998 | 270740140.1395
 MOROCCO                   |   1997 | 471350594.0778
 MOROCCO                   |   1996 | 475581124.0037
 MOROCCO                   |   1995 | 468022926.5144
 MOROCCO                   |   1994 | 468717044.6489
 MOROCCO                   |   1993 | 466388284.6689
 MOROCCO                   |   1992 | 477342056.5988
 MOZAMBIQUE                |   1998 | 274930114.3740
 MOZAMBIQUE                |   1997 | 458167592.7826
 MOZAMBIQUE                |   1996 | 465025455.5507
 MOZAMBIQUE                |   1995 | 462547975.5172
 MOZAMBIQUE                |   1994 | 463103579.1485
 MOZAMBIQUE                |   1993 | 452574004.0909
 MOZAMBIQUE                |   1992 | 457340626.8603
 PERU                      |   1998 | 271609274.7732
 PERU                      |   1997 | 474639767.3746
 PERU                      |   1996 | 463452228.3155
 PERU                      |   1995 | 468742647.8916
 PERU                      |   1994 | 461061151.3348
 PERU                      |   1993 | 468546461.6356
 PERU                      |   1992 | 470703173.1381
 ROMANIA                   |   1998 | 272266149.0522
 ROMANIA                   |   1997 | 468011594.7485
 ROMANIA                   |   1996 | 465198691.9635
 ROMANIA                   |   1995 | 462384158.9251
 ROMANIA                   |   1994 | 470577272.8710
 ROMANIA                   |   1993 | 461569376.8328
 ROMANIA                   |   1992 | 465576684.3604
 RUSSIA                    |   1998 | 276426180.5891
 RUSSIA                    |   1997 | 459943242.7206
 RUSSIA                    |   1996 | 469446546.3558
 RUSSIA                    |   1995 | 461596902.3475
 RUSSIA                    |   1994 | 461877587.8155
 RUSSIA                    |   1993 | 460579584.0117
 RUSSIA                    |   1992 | 470682370.7145
 SAUDI ARABIA              |   1998 | 282058825.2227
 SAUDI ARABIA              |   1997 | 471720755.7607
 SAUDI ARABIA              |   1996 | 479039732.4120
 SAUDI ARABIA              |   1995 | 483803767.6558
 SAUDI ARABIA              |   1994 | 474417506.5827
 SAUDI ARABIA              |   1993 | 480712672.9951
 SAUDI ARABIA              |   1992 | 482867693.6672
 UNITED KINGDOM            |   1998 | 267158728.5042
 UNITED KINGDOM            |   1997 | 463694231.7319
 UNITED KINGDOM            |   1996 | 461862262.2285
 UNITED KINGDOM            |   1995 | 451927872.8840
 UNITED KINGDOM            |   1994 | 455560215.6679
 UNITED KINGDOM            |   1993 | 459555619.7756
 UNITED KINGDOM            |   1992 | 464458270.0625
 UNITED STATES             |   1998 | 272010714.4235
 UNITED STATES             |   1997 | 473953763.9704
 UNITED STATES             |   1996 | 469520471.1641
 UNITED STATES             |   1995 | 469048602.1466
 UNITED STATES             |   1994 | 479534991.3109
 UNITED STATES             |   1993 | 470720217.0671
 UNITED STATES             |   1992 | 472747797.9446
 VIETNAM                   |   1998 | 271193310.1974
 VIETNAM                   |   1997 | 465092936.7374
 VIETNAM                   |   1996 | 469416954.9658
 VIETNAM                   |   1995 | 463375050.2799
 VIETNAM                   |   1994 | 462122089.1812
 VIETNAM                   |   1993 | 459527281.6245
 VIETNAM                   |   1992 | 458846178.8327
(175 rows)

COMMIT;
COMMIT
