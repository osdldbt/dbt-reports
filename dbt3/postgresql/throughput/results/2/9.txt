BEGIN;
BEGIN
select
	nation,
	o_year,
	sum(amount) as sum_profit
from
	(
		select
			n_name as nation,
			extract(year from o_orderdate) as o_year,
			l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
		from
			part,
			supplier,
			lineitem,
			partsupp,
			orders,
			nation
		where
			s_suppkey = l_suppkey
			and ps_suppkey = l_suppkey
			and ps_partkey = l_partkey
			and p_partkey = l_partkey
			and o_orderkey = l_orderkey
			and s_nationkey = n_nationkey
			and p_name like '%chocolate%'
	) as profit
group by
	nation,
	o_year
order by
	nation,
	o_year desc;
          nation           | o_year |   sum_profit   
---------------------------+--------+----------------
 ALGERIA                   |   1998 | 273713919.6663
 ALGERIA                   |   1997 | 472203135.7600
 ALGERIA                   |   1996 | 469327249.7704
 ALGERIA                   |   1995 | 456165698.0521
 ALGERIA                   |   1994 | 462939838.5806
 ALGERIA                   |   1993 | 458755798.3466
 ALGERIA                   |   1992 | 461323929.6972
 ARGENTINA                 |   1998 | 274619304.6552
 ARGENTINA                 |   1997 | 470860391.3265
 ARGENTINA                 |   1996 | 472896542.4548
 ARGENTINA                 |   1995 | 473935831.6863
 ARGENTINA                 |   1994 | 474271443.5551
 ARGENTINA                 |   1993 | 472416229.6604
 ARGENTINA                 |   1992 | 470373858.5781
 BRAZIL                    |   1998 | 280232840.7749
 BRAZIL                    |   1997 | 474717330.5427
 BRAZIL                    |   1996 | 470681128.3046
 BRAZIL                    |   1995 | 477501130.1469
 BRAZIL                    |   1994 | 477246574.4522
 BRAZIL                    |   1993 | 469907614.2002
 BRAZIL                    |   1992 | 467583410.9624
 CANADA                    |   1998 | 273753181.0943
 CANADA                    |   1997 | 469000255.1649
 CANADA                    |   1996 | 473919722.4222
 CANADA                    |   1995 | 474204108.2615
 CANADA                    |   1994 | 478716932.7992
 CANADA                    |   1993 | 476794780.0470
 CANADA                    |   1992 | 479061795.4311
 CHINA                     |   1998 | 277121803.4667
 CHINA                     |   1997 | 468158423.3601
 CHINA                     |   1996 | 474966462.3519
 CHINA                     |   1995 | 475432561.6367
 CHINA                     |   1994 | 469684998.6194
 CHINA                     |   1993 | 469319740.0559
 CHINA                     |   1992 | 478375166.1523
 EGYPT                     |   1998 | 274860108.2534
 EGYPT                     |   1997 | 464001921.2143
 EGYPT                     |   1996 | 457201109.4022
 EGYPT                     |   1995 | 467423772.5674
 EGYPT                     |   1994 | 467223487.2799
 EGYPT                     |   1993 | 467366917.6780
 EGYPT                     |   1992 | 466112705.8453
 ETHIOPIA                  |   1998 | 272880147.6022
 ETHIOPIA                  |   1997 | 455867424.2010
 ETHIOPIA                  |   1996 | 460420938.8822
 ETHIOPIA                  |   1995 | 465077972.4722
 ETHIOPIA                  |   1994 | 466818598.6461
 ETHIOPIA                  |   1993 | 461659242.8756
 ETHIOPIA                  |   1992 | 461985412.6125
 FRANCE                    |   1998 | 269290953.1835
 FRANCE                    |   1997 | 458784058.5795
 FRANCE                    |   1996 | 461133075.4577
 FRANCE                    |   1995 | 455715002.5028
 FRANCE                    |   1994 | 461291478.0522
 FRANCE                    |   1993 | 458605012.8141
 FRANCE                    |   1992 | 459303676.2401
 GERMANY                   |   1998 | 281427283.4825
 GERMANY                   |   1997 | 480022691.3803
 GERMANY                   |   1996 | 474789597.8136
 GERMANY                   |   1995 | 489737643.7860
 GERMANY                   |   1994 | 483302172.7736
 GERMANY                   |   1993 | 479977123.7489
 GERMANY                   |   1992 | 483819127.7604
 INDIA                     |   1998 | 277454383.3813
 INDIA                     |   1997 | 476114377.0381
 INDIA                     |   1996 | 479588676.5539
 INDIA                     |   1995 | 480033995.9782
 INDIA                     |   1994 | 475360813.9467
 INDIA                     |   1993 | 480286831.6561
 INDIA                     |   1992 | 482141424.3124
 INDONESIA                 |   1998 | 274405791.0206
 INDONESIA                 |   1997 | 458164676.3464
 INDONESIA                 |   1996 | 467975752.0498
 INDONESIA                 |   1995 | 469226414.9086
 INDONESIA                 |   1994 | 460675561.6006
 INDONESIA                 |   1993 | 474861465.3194
 INDONESIA                 |   1992 | 473087481.5513
 IRAN                      |   1998 | 276452402.8910
 IRAN                      |   1997 | 471797957.8724
 IRAN                      |   1996 | 467163551.8779
 IRAN                      |   1995 | 465311342.9231
 IRAN                      |   1994 | 471226265.6764
 IRAN                      |   1993 | 469833605.3785
 IRAN                      |   1992 | 469767071.2486
 IRAQ                      |   1998 | 276730100.2960
 IRAQ                      |   1997 | 485092108.6051
 IRAQ                      |   1996 | 478911358.5445
 IRAQ                      |   1995 | 474514286.0968
 IRAQ                      |   1994 | 474331096.5282
 IRAQ                      |   1993 | 479023587.4760
 IRAQ                      |   1992 | 473738478.1485
 JAPAN                     |   1998 | 271428112.3946
 JAPAN                     |   1997 | 471764858.9274
 JAPAN                     |   1996 | 471714940.6295
 JAPAN                     |   1995 | 465001060.2760
 JAPAN                     |   1994 | 460383573.2207
 JAPAN                     |   1993 | 468572650.4022
 JAPAN                     |   1992 | 462475497.2066
 JORDAN                    |   1998 | 274802296.5160
 JORDAN                    |   1997 | 467539169.1926
 JORDAN                    |   1996 | 459108318.7909
 JORDAN                    |   1995 | 463937602.3705
 JORDAN                    |   1994 | 468189459.9247
 JORDAN                    |   1993 | 472918493.4718
 JORDAN                    |   1992 | 462873908.5523
 KENYA                     |   1998 | 279038064.1597
 KENYA                     |   1997 | 474434601.2854
 KENYA                     |   1996 | 478646552.7512
 KENYA                     |   1995 | 479670773.0713
 KENYA                     |   1994 | 468404000.1805
 KENYA                     |   1993 | 467079439.2898
 KENYA                     |   1992 | 478964325.3275
 MOROCCO                   |   1998 | 282134189.3979
 MOROCCO                   |   1997 | 469929924.7994
 MOROCCO                   |   1996 | 470302393.6415
 MOROCCO                   |   1995 | 476428782.4546
 MOROCCO                   |   1994 | 476021524.2425
 MOROCCO                   |   1993 | 468209604.3898
 MOROCCO                   |   1992 | 468792478.4512
 MOZAMBIQUE                |   1998 | 271630255.1835
 MOZAMBIQUE                |   1997 | 466183158.4271
 MOZAMBIQUE                |   1996 | 463444132.8487
 MOZAMBIQUE                |   1995 | 460333968.3581
 MOZAMBIQUE                |   1994 | 464425808.7518
 MOZAMBIQUE                |   1993 | 462606658.5740
 MOZAMBIQUE                |   1992 | 461570057.2434
 PERU                      |   1998 | 273933918.4975
 PERU                      |   1997 | 467941432.9501
 PERU                      |   1996 | 468698737.1216
 PERU                      |   1995 | 467480185.3799
 PERU                      |   1994 | 470041870.7772
 PERU                      |   1993 | 470417973.1875
 PERU                      |   1992 | 470829015.9734
 ROMANIA                   |   1998 | 277527372.7349
 ROMANIA                   |   1997 | 477245023.0059
 ROMANIA                   |   1996 | 482732726.7905
 ROMANIA                   |   1995 | 466092348.8507
 ROMANIA                   |   1994 | 465737220.7967
 ROMANIA                   |   1993 | 467948785.1364
 ROMANIA                   |   1992 | 470842592.2618
 RUSSIA                    |   1998 | 280559432.1129
 RUSSIA                    |   1997 | 475476626.2136
 RUSSIA                    |   1996 | 473716832.0149
 RUSSIA                    |   1995 | 478970738.7675
 RUSSIA                    |   1994 | 471599642.5678
 RUSSIA                    |   1993 | 480751951.3381
 RUSSIA                    |   1992 | 473896553.5901
 SAUDI ARABIA              |   1998 | 279647874.4956
 SAUDI ARABIA              |   1997 | 471254379.4641
 SAUDI ARABIA              |   1996 | 472624539.0616
 SAUDI ARABIA              |   1995 | 468769755.6487
 SAUDI ARABIA              |   1994 | 468455048.6473
 SAUDI ARABIA              |   1993 | 469540128.0177
 SAUDI ARABIA              |   1992 | 468281105.4863
 UNITED KINGDOM            |   1998 | 265291881.5382
 UNITED KINGDOM            |   1997 | 457646571.0741
 UNITED KINGDOM            |   1996 | 466670524.5403
 UNITED KINGDOM            |   1995 | 460115020.5258
 UNITED KINGDOM            |   1994 | 462867354.5312
 UNITED KINGDOM            |   1993 | 460819835.3517
 UNITED KINGDOM            |   1992 | 459905265.8962
 UNITED STATES             |   1998 | 284935130.2970
 UNITED STATES             |   1997 | 471288979.5636
 UNITED STATES             |   1996 | 477591650.5499
 UNITED STATES             |   1995 | 474401419.1426
 UNITED STATES             |   1994 | 479863544.7441
 UNITED STATES             |   1993 | 472967064.2171
 UNITED STATES             |   1992 | 478366170.2528
 VIETNAM                   |   1998 | 272123586.7591
 VIETNAM                   |   1997 | 466169748.1059
 VIETNAM                   |   1996 | 479220198.3259
 VIETNAM                   |   1995 | 465243987.9570
 VIETNAM                   |   1994 | 471093076.4998
 VIETNAM                   |   1993 | 475682028.4958
 VIETNAM                   |   1992 | 469916431.2622
(175 rows)

COMMIT;
COMMIT
